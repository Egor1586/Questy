{% extends "base.html" %}

{% block title %}
    Result test online
{% endblock %}

{% block links %}
    <link rel = "stylesheet" href = "{{ url_for('test_app.static', filename='css/review_results.css') }}">
{% endblock %}

{% block content %}
    <div class="container">
        <div class="result-info">
            <div class="test-info">
                {% if username %}
                    <p><strong>{{ username }}</strong>, ваш результат: <strong>{{ count_correct_answers }} </strong>/ <strong>{{ list_quiz|length }}</strong></p>
                {% else %}
                    <p>Ваш результат: <strong>{{ count_correct_answers }}</strong> з {{ list_quiz|length }}</p>
                {% endif %}
                
                <p>Точність правильних відповідей: <strong>{{ accuracy }}%</strong></p>

                {% if bask_to_class %}
                    <a class="home-link" href="/class_courses{{ bask_to_class }}">
                        <button class="home-btn">До класу</button>
                    </a>
                {% else %}
                    <a class="home-link" href="/profile">
                        <button class="home-btn">До профiлю</button>
                    </a>
                {% endif %}
            </div>

            <div class="answer-info">
                <ul>
                    <li><span class="color-dot color-green"></span>Правильна відповідь (зелений)</li>
                    <li><span class="color-dot color-yellow"></span>Ваша неправильна відповідь (жовтий)</li>
                    <li><span class="color-dot color-red"></span>Неправильна відповідь (червоний)</li>
                </ul>
            </div>
        </div>

            
        {% if not username %}
            <div class="user-information">
                <div class="auth-block">
                    <p>Якщо ви хочете відстежувати свій прогрес у Qusty - створіть свій аккаунт та стежте за своїм прогресом</p>
                    <a href="/sign_up" class="auth-btn">Реєстрація</a>
                </div>
        
                <div class="auth-block">
                    <p>Якщо у вас вже є аккаунт - авторизуйтесь</p>
                    <a href="login" class="auth-btn">Авторизація</a>
                </div>
            </div>
        {% endif %}

        {% for question in list_quiz %}
            {% if question.question_type == "choice" or question.question_type == "image" %}
                {% set answers = list_answers[loop.index0] %}
                {% set user_answer = user_answers[loop.index0] %}
            {% elif question.question_type == "input" %} 
                {% set user_answer = user_answers[loop.index0] %}
                {% set answer = list_answers[loop.index0] %}
            {% elif question.question_type == "multiple_choice" %} 
                {% set answers = list_answers[loop.index0] %}
                {% set user_answers = user_answers[loop.index0] %}
            {% endif %}
            
            <div class="question-block">
                <div class="question-header">
                    <div>{{ question.question_text }}</div>
                </div>

                {% if question.question_type == "image" %}
                    <div class="img-div">
                        <img src="/test_app/static/images/{{ test.id }}/{{ question.image_name }}" alt="quiz image">
                    </div>
                {% endif %}
                
                {% if question.question_type == "choice" or question.question_type == "image" %}
                    <div class="question-text">
                        Варіант відповідей.
                    </div>
                    
                    {% for answer in answers %}
                        {% if answer != question.correct_answer and answer != user_answer%}
                            <div class="answer incorrect">✗ {{answer}}</div>   
                        {% elif user_answer != question.correct_answer and user_answer == "not_answer" %}      
                            <div class="answer no-answer">Відповідь відсутня</div>
                        {% elif user_answer != question.correct_answer and answer == user_answer %}
                            <div class="answer user_answers">✗ {{answer}}</div>
                        {% else %}
                            <div class="answer correct">✓ {{ answer }}</div>
                        {% endif %}
                    {% endfor %}
                
                {% elif question.question_type == "input" %} 
                    <div class="question-text">
                        Варіант відповідей.
                    </div>

                    {% if user_answer == "not_answer"%}
                        <div class="answer no-answer">Відповідь відсутня</div>
                        <div class="answer correct">✓ {{ question.correct_answer }}</div>
                    {% elif answer != user_answer %} 
                        <div class="answer incorrect">✗ {{user_answer}}</div>   
                        <div class="question-text">
                            Правильний варіант.
                        </div>
                        <div class="answer correct">✓ {{ question.correct_answer }}</div>   
                    {% else %}
                        <div class="answer correct">✓ {{ user_answer }}</div>
                    {% endif %}
                {% elif question.question_type == "multiple_choice" %}         
                    {% set correct_answer_list = question.correct_answer.split("%$№") %}
                
                    <div class="question-text">
                        Варіант відповідей.
                    </div>
                    
                    {% if "not_answer" in user_answers %}
                        <div class="answer no-answer">Відповідь відсутня</div>
                    {% endif %}
                    
                    {% for answer in answers %}                                      
                        {% if answer in correct_answer_list%}
                            <div class="answer correct">✗ {{answer}}</div>   
                        {% elif answer not in correct_answer_list and answer in user_answers %}
                            <div class="answer user_answers">✗ {{answer}}</div>
                        {% else %}
                            <div class="answer incorrect">✓ {{ answer }}</div>
                        {% endif %}

                    {% endfor %}
                {% endif %}
            </div>
        {% endfor %}
    </div>
{% endblock %}